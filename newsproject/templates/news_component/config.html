{% extends 'layout/layout.html' %}
{% block body %}
    {{ block.super }}

    <div class="container">
        <div class="list-inline list-inline2 config">
            <h4>뉴스 맞춤 설정</h4>
        </div>
    </div>
    <form method="post">
        {% csrf_token %}
        <div class="container">
            <button type="button" class="btn btn-primary" onClick="addFields();">추가</button>
            <div class="list-rank">
                <h5>1순위</h5>
            </div>
            <div class="list-inline" id="listInline">
                <select class="form-control section" style="width:35%" id="sectionArea" name="section1">
                    {% for section in sections %}
                        <option value="{{ section.news_section }}">{{ section.get_section_name }}</option>
                    {% endfor %}
                </select>
                <select class="form-control company" style="width:35%" id="companyArea" name="company1">
                    {% for company in companys %}
                        <option value="{{ company.news_company }}">{{ company.get_company_name }}</option>
                    {% endfor %}
                </select>
                <select class="form-control" style="width:20%" name="how_many1">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
            </div>
            <div id="container"></div>
        </div>
    <br>
    <br>
    <button type="submit" class="btn btn-primary">설정 저장</button>
    </form>

{% block script %}
   {{ block.super }}
  <script type="text/javascript">

{#        var section_area = document.getElementById('sectionArea');#}
{#        var company_area = document.getElementById('companyArea');#}
        var $list = $('.container');

        var number = 1;
        var max_number = 10;
        var arr_section = [];
        var arr_company = [];
        {% for section in sections %}
            arr_section.push('{{ section.get_section_name }}');
        {% endfor %}
        {% for company in companys %}
            arr_company.push('{{ company.get_company_name }}');
        {% endfor %}

        var sectionArea = document.querySelector('#sectionArea');

        function changeField(data, self) {

            var $self = $(self),
                createOption = document.createElement('option'),
                $companyArea = $self.next();

            function createOptions(data) {
                var options = document.createElement('option');
                options.value = data.value;
                options.innerHTML = data.name;
                return options;
            }

            $companyArea.html('');

            for(var prop in data) {
                if(data[prop].sectionName == sectionArea.value) {
                    //companyArray.push(data[prop].companyName);
                    $companyArea.append( createOptions({ value:data[prop].companyValue, name:data[prop].companyName}) );
                }
            }
        }

        $list.on('change', 'select.section', function() {
            var data = [];
            {% for content in contents %}
                data.push({
                    sectionName: '{{ content.news_section }}',
                    companyValue: '{{ content.news_company }}',
                    companyName: '{{ content.get_company_name }}'
                    });
            {% endfor %}

            changeField(data, this);
        });

        function addFields() {
            if(number >= max_number){
                alert('기사 설정은 최대 10개 까지 할 수 있습니다');
                return false;
            }
            // Number of inputs to create
            // Container <div> where dynamic content will be placed
            var container = document.getElementById("container");
            // Append a node with a random text
            container.appendChild(document.createTextNode((number + 1) + "순위"));
            // Create an <input> element, set its type and name attributes

            var div = document.createElement("div");
            div.className = "list-inline";
            container.appendChild(div);
            var section_select = document.createElement("select");
            section_select.className = "form-control section";
            section_select.name = "section" + (number + 1);
            section_select.style = "width:35%";
            container.appendChild(section_select);
            for (var i = 0; i < arr_section.length; i++) {
                var option = document.createElement("option");
                option.text = arr_section[i];
                section_select.appendChild(option);
            }
            var company_select = document.createElement("select");
            company_select.className = "form-control company";
            company_select.name = "company" + (number + 1);
            company_select.style = "width:35%";
            container.appendChild(company_select);
            for (var i = 0; i < arr_company.length; i++) {
                var option = document.createElement("option");
                option.text = arr_company[i];
                company_select.appendChild(option);
            }
            var num_select = document.createElement("select");
            num_select.className = "form-control";
            num_select.name = "how_many" + (number + 1);
            num_select.style = "width:20%";
            container.appendChild(num_select);
            for (var i = 1; i < max_number; i++) {
                var option = document.createElement("option");
                option.text = i;
                num_select.appendChild(option);
            }
            // Append a line break
            container.appendChild(document.createElement("br"));
            number++
        }
    </script>
{% endblock %}
{% endblock %}